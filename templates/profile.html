{% extends "base.html" %}

{% block title %}–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç{% endblock %}

{% block additional_styles %}
.calendar-day {
    width: 20px;
    height: 20px;
    border-radius: 4px;
    display: inline-block;
    margin: 2px;
    transition: transform 0.2s ease;
}
.calendar-day:hover {
    transform: scale(1.1);
}
.calendar-day.level-0 { background-color: #ebedf0; }
.calendar-day.level-1 { background-color: #bbf7d0; }
.calendar-day.level-2 { background-color: #4ade80; }
.calendar-day.level-3 { background-color: #16a34a; }
.calendar-day.level-4 { background-color: #196127; }
{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl font-bold text-orange-500 mb-8">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</h1>
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- –°–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤ -->
        <div class="lg:col-span-2 bg-white p-6 rounded-2xl shadow-md">
            <h2 class="text-xl font-semibold mb-4">–ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤</h2>
            <!-- –°–æ–æ–±—â–µ–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞–∫–∞–∑–æ–≤ -->
            <div class="mb-6 p-4 rounded-2xl bg-gradient-to-r from-yellow-50 to-yellow-100 shadow-md border border-yellow-200">
                {% set orders_count = orders|length %}
                {% if orders_count == 0 %}
                    <p class="text-sm text-gray-500">
                        –£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–∫–∞–∑–æ–≤. 
                        <a href="{{ url_for('menu') }}" class="text-orange-500 hover:underline font-semibold">–ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞—à–µ –º–µ–Ω—é!</a>
                    </p>
                {% elif orders_count <= 2 %}
                    <p class="text-sm text-yellow-700 font-medium">
                        –í—ã —Å–¥–µ–ª–∞–ª–∏ {{ orders_count }} –∑–∞–∫–∞–∑{{ "–∞" if orders_count == 1 else "–∞" }} –∑–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –Ω–µ–¥–µ–ª—é ‚Äî –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –Ω–∞—à–∏ –Ω–æ–≤–∏–Ω–∫–∏! ‚ú®
                    </p>
                {% elif orders_count <= 5 %}
                    <p class="text-sm text-green-700 font-medium">
                        –í—ã —Å–¥–µ–ª–∞–ª–∏ {{ orders_count }} –∑–∞–∫–∞–∑–∞ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –Ω–µ–¥–µ–ª—é ‚Äî –æ—Ç–ª–∏—á–Ω—ã–π –≤—ã–±–æ—Ä –¥–ª—è –∑–¥–æ—Ä–æ–≤–æ–≥–æ –ø–∏—Ç–∞–Ω–∏—è! ü•¶üí™
                    </p>
                {% else %}
                    <p class="text-sm text-blue-700 font-medium">
                        –í—ã —Å–¥–µ–ª–∞–ª–∏ <b>{{ orders_count }} –∑–∞–∫–∞–∑–æ–≤</b> –∑–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –Ω–µ–¥–µ–ª—é ‚Äî –≤—ã –Ω–∞—Å—Ç–æ—è—â–∏–π —Ñ–∞–Ω–∞—Ç <b>FastFit</b>! üéâüî•
                    </p>
                {% endif %}
            </div>
            <div class="space-y-6">
                {% for order in orders %}
                <div class="relative bg-white rounded-2xl shadow-md overflow-hidden">
                    <div class="absolute top-0 left-0 w-full h-2 {{ order.status_color }}"></div>
                    <div class="p-6 space-y-4">
                        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∑–∞–∫–∞–∑–∞ -->
                        <div class="flex justify-between items-center">
                            <div>
                                <h3 class="text-lg font-semibold">
                                    <a href="{{ url_for('order_details', order_id=order.id) }}" class="text-orange-500 hover:underline">
                                        –ó–∞–∫–∞–∑ –æ—Ç {{ order.date.strftime('%d.%m.%Y') }}
                                    </a>
                                </h3>
                                <p class="text-sm text-gray-600">{{ order.date.strftime('%d.%m.%Y %H:%M') }}</p>
                            </div>
                            <p class="text-lg font-bold text-gray-800">{{ order.total }} ‚ÇΩ</p>
                        </div>

                        <!-- –°–æ—Å—Ç–∞–≤ –∑–∞–∫–∞–∑–∞ -->
                        <ul class="text-sm text-gray-600 space-y-3">
                            {% for item in order.units %}
                            <li class="flex items-center gap-4">
                                <!-- –ö–∞—Ä—Ç–∏–Ω–∫–∞ –±–ª—é–¥–∞ -->
                                <img src="{{ item.dish.image }}" alt="{{ item.dish.name }}" class="w-16 h-16 object-cover rounded-xl flex-shrink-0">
                                <div class="flex-1">
                                    <div class="flex justify-between items-center">
                                        <span class="font-medium">{{ item.quantity }}x {{ item.dish.name }}</span>
                                        <span class="font-semibold">{{ (item.quantity * item.price)|round(2) }} ‚ÇΩ</span>
                                    </div>
                                    <p class="text-xs text-gray-500 mt-1">
                                        –ö–∞–ª–æ—Ä–∏–∏: {{ (item.quantity * item.dish.calories)|round(0) }} –∫–∫–∞–ª |
                                        –ë–µ–ª–∫–∏: {{ (item.quantity * item.dish.proteins)|round(0) }} –≥ |
                                        –ñ–∏—Ä—ã: {{ (item.quantity * item.dish.fats)|round(0) }} –≥ |
                                        –£–≥–ª–µ–≤–æ–¥—ã: {{ (item.quantity * item.dish.carbohydrates)|round(0) }} –≥
                                    </p>
                                </div>
                            </li>
                            {% endfor %}
                        </ul>

                        <!-- –û–±—â–∏–π –ö–ë–ñ–£ -->
                        {% set totals = namespace(calories=0, proteins=0, fats=0, carbs=0) %}
                        {% for item in order.units %}
                            {% set totals.calories = totals.calories + item.quantity * item.dish.calories %}
                            {% set totals.proteins = totals.proteins + item.quantity * item.dish.proteins %}
                            {% set totals.fats = totals.fats + item.quantity * item.dish.fats %}
                            {% set totals.carbs = totals.carbs + item.quantity * item.dish.carbohydrates %}
                        {% endfor %}
                        <p class="text-sm text-gray-600">
                            <span class="font-semibold">–û–±—â–∏–π –ö–ë–ñ–£:</span>
                            –ö–∞–ª–æ—Ä–∏–∏: {{ totals.calories|round(0) }} –∫–∫–∞–ª |
                            –ë–µ–ª–∫–∏: {{ totals.proteins|round(0) }} –≥ |
                            –ñ–∏—Ä—ã: {{ totals.fats|round(0) }} –≥ |
                            –£–≥–ª–µ–≤–æ–¥—ã: {{ totals.carbs|round(0) }} –≥
                        </p>

                        <!-- –°—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ –≤ –≤–∏–¥–µ pill -->
                        <p class="inline-block px-3 py-1 rounded-full font-semibold text-white {{ order.status_color }}">
                            {{ order.status|capitalize }}
                        </p>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- –ö–∞–ª–µ–Ω–¥–∞—Ä—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ -->
        <div class="bg-white p-6 rounded-2xl shadow-md max-h-[260px]">
            <h2 class="text-xl font-semibold mb-4">–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∑–∞–∫–∞–∑–æ–≤</h2>
            <p class="text-sm text-gray-600 mb-4">–í–∞—à–∏ –∑–∞–∫–∞–∑—ã –∑–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –Ω–µ–¥–µ–ª—é</p>
            <div class="calendar flex flex-wrap gap-1 justify-center">
                {% for day in activity %}
                <div class="calendar-day level-{{ day.level }}" title="{{ day.date }}: {{ day.orders_count }} –∑–∞–∫–∞–∑(–æ–≤)" aria-label="{{ day.date }}: {{ day.orders_count }} –∑–∞–∫–∞–∑(–æ–≤)"></div>
                {% endfor %}
            </div>
            <div class="mt-4 text-sm text-gray-600">
                <p><span class="inline-block w-4 h-4 bg-gray-200 rounded mr-2"></span>0 –∑–∞–∫–∞–∑–æ–≤</p>
                <p><span class="inline-block w-4 h-4 bg-green-200 rounded mr-2"></span>1 –∑–∞–∫–∞–∑</p>
                <p><span class="inline-block w-4 h-4 bg-green-400 rounded mr-2"></span>2 –∑–∞–∫–∞–∑–∞</p>
                <p><span class="inline-block w-4 h-4 bg-green-600 rounded mr-2"></span>3+ –∑–∞–∫–∞–∑–∞</p>
            </div>
        </div>
    </div>
</div>
{% endblock %}